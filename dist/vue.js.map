{"version":3,"file":"vue.js","sources":["../src/util.js","../src/observe/array.js","../src/observe/index.js","../src/state.js","../src/init.js","../src/index.js"],"sourcesContent":["export function isObject(obj) {\n  return typeof obj === 'object' && obj !== null;\n}","let oldArrayMethods = Array.prototype; // 获取数组原型上的方法\n// 创建一个全新的对象，可以找到数组原型上的方法，而且修改对象时，不会影响原来对象上的方法\nexport let arrayMethods = Object.create(oldArrayMethods);\n\nlet methods = [ // 这7个方法都会改变原数组\n  'push',\n  'pop',\n  'shift',\n  'unshift',\n  'short',\n  'reverse',\n  'splice'\n];\n\nmethods.forEach(method => {\n  arrayMethods[method] = function(...args) { // 函数劫持，AOP的思想\n    // 当用户调用数组的方法时，会先调用我的逻辑，在调用数组本身的逻辑\n    const ob = this.__ob__;\n    let result = oldArrayMethods[method].apply(this, args);\n    // 特殊处理，push unshift splice 都可以像数组新增属性（新增的属性可能是一个对象）\n    // 内部还对数组中的引用类型也做了一次劫持\n    let inserted = [];\n    switch (method) {\n      case 'push':\n      case 'unshift':\n        inserted = args;\n        break;\n      case 'splice': // 可以增、删、改 从第三个参数开始才是新增的属性\n        inserted = args.slice(2);\n        break;\n      default:\n        break;\n    }\n    inserted && ob.observeArray(inserted); // 新增的属性也需要去调用此方法监听更改。那么这是两个文件，如何才能拿到上一个文件的此方法呢？？\n    return result;\n  }\n});","import { isObject } from './../util.js';\nimport { arrayMethods } from './array.js'\nclass Observer {\n  constructor(data) {\n    // 要想在array.js 中调用observeArray方法，在data增加一个属性\n    Object.defineProperty(data, '__ob__', { // 是一个响应式的标识\n      enumerable: false, // 设置不可枚举，就不能被Object.keys使用\n      configurable: false,\n      value: this\n    });\n    // data.__ob__ = this; // 相当于在数据上可以获取__ob__ 这个属性，就可以获取到Observer实例 // 直接这样写会出现无限递归\n    // 对数组索引拦截，性能差，直接更改索引的情况比较少\n    if (Array.isArray(data)) {\n      // vue 中数组主要是用的重写数组的方法，将数组的方法进行包装\n      // 函数劫持，改变数组本身的方法就可以监听到了\n      data.__proto__ = arrayMethods; // 通过原型链向上查找的方式\n      // 可能会有 arr: [{a: 1}] => arr[0].a = 100; 这种也能被监听\n      this.observeArray(data);\n    } else {\n      this.walk(data); // 可以对数据一步一步的处理\n    }\n  }\n  observeArray (data) {\n    for (let i = 0; i < data.length; i++) {\n      observe(data[i]);\n    }\n  }\n  walk (data) {\n    Object.keys(data).forEach(key => {\n      defineReactive(data, key, data[key]);\n    })\n  }\n}\n\nfunction defineReactive(data, key, value) {\n  observe(value); // 深度监听\n  Object.defineProperty(data, key, {\n    get() {\n      return value;\n    },\n    set(newValue) {\n      if (newValue === value) return;\n      observe(newValue); // 如果设置的值也是个对象，也要进行观测\n      value = newValue; \n    }\n  })\n}\nexport function observe(data) {\n  // 对象就是使用 Object.defineProperty 来观测数据\n  if(!isObject(data)) {\n    return data;\n  }\n  if (data.__ob__ instanceof Observer) { // 防止对象被重复观测\n    return data;\n  }\n  // 对数据进行观测\n  return new Observer(data); // 可以看到当前数据是否有被观测过\n}\n","import { observe } from './observe/index.js';\nexport function initState(vm) {\n  const options = vm.$options;\n  // 根据不同的属性。进行不同的初始化\n  if (options.props) {\n    initProps(vm);\n  }\n  if (options.methods) {\n    initMethod(vm);\n  }\n  if (options.data) {\n    initData(vm);\n  }\n}\n\nfunction initProps(vm) { }\nfunction initMethod(vm) { }\nfunction initData(vm) {\n  let data = vm.$options.data;\n  // 拿到用户传入的data数据\n  data = vm._data = typeof data === 'function' ? data.call(vm) : data;\n  // 给所有的属性增加get/set\n  observe(data); // 观测整个数据\n}","import { initState } from './state.js'\nexport function initMixin(Vue) {\n  Vue.prototype._init = function(options) {\n    // $options\n    const vm = this;\n    vm.$options = options; // 用户传入的参数\n\n    initState(vm) // 初始化状态\n  }\n}","import {initMixin} from './init';\nfunction Vue(options) {\n  // 内部进行初始化\n  this._init(options);\n}\ninitMixin(Vue);\n\nexport default Vue;"],"names":["isObject","obj","oldArrayMethods","Array","prototype","arrayMethods","Object","create","methods","forEach","method","ob","__ob__","args","result","apply","inserted","slice","observeArray","Observer","data","defineProperty","enumerable","configurable","value","isArray","__proto__","walk","i","length","observe","keys","key","defineReactive","get","set","newValue","initState","vm","options","$options","props","initData","_data","call","initMixin","Vue","_init"],"mappings":"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"}